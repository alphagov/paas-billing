# ADR001: Include record for services/resources provisioned for tenants

## Status

Accepted

## Context

The Paas billing system receives a series of events from Cloudfoundry notifying whether services/resources have been created/renamed/deleted, when, for which tenant, etc.

The original Paas billing system then goes through several stages of processing, translating the Cloudfoundry events into records of services/resources by calendar month before calculating the final monthly bill for each tenant. This complex process is done every month, at the start of the month, and there is no persistent record of the results of each stage of processing, including what services/resources tenants have provisioned. After each stage of processing database tables are populated but the contents of these tables are impermanent, being refreshed each month.

If there is a problem with a tenant's bill it is very difficult to go backwards from the bill to find the source of the problem.

## Decision

There is no need to regenerate historical records of services/resources provisioned for tenants each time billing is run each month since this information does not change. Furthermore, recording this information for each month makes it difficult for us to calculate bills between any two dates and times. We instead need to have a persistent record of the services/resources each tenant has provisioned with a from- and to-date denoting when the service/resource was/is being used. This persistent record is in the new `resources` table.

The `resources` table also acts as an audit point within Paas billing. It makes investigation of discrepancies in tenant bills easier to investigate. Anyone supporting Paas billing can first look at the contents of `resources` and see whether the discrepancy arose in the population of `resources` or afterwards in the calculation of the actual bill.

## Consequences

This makes billing easier to support. It also makes billing run much more quickly since we do not need to go through all the Cloudfoundry events whenever we need to calculate tenant bills. With this method we can calculate tenants' bills on-demand, rather than calculating all bills in advance as original Paas billing system did, so it opens up the possibility of the following:
    - Calculating bills between any 2 dates and times quickly
    - It is easy to break down bills by org, space, etc., or, later on, by annotation
